<div class="coach-tab-container">
  <div class="tab-header">
    <h2>Gestion des Coachs</h2>
    <button 
      class="btn btn-primary" 
      (click)="toggleCreateForm()"
      *ngIf="!showCreateForm"
    >
      <i class="fas fa-plus"></i>
      Ajouter un Coach
    </button>
  </div>

  <div class="create-form-container" *ngIf="showCreateForm">
    <div class="form-header">
      <h3>Créer un nouveau coach</h3>
      <button class="close-btn" (click)="hideCreateForm()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div class="success-alert" *ngIf="showSuccess">
      <i class="fas fa-check-circle"></i>
      Coach créé avec succès !
    </div>

    <div class="error-alert" *ngIf="errorMessage">
      <i class="fas fa-exclamation-triangle"></i>
      {{ errorMessage }}
    </div>

    <form [formGroup]="coachForm" (ngSubmit)="onSubmit()" class="compact-form">
      
      <div class="form-group">
        <label class="block text-sm font-medium text-gray-700 mb-2">
          Photo de profil
        </label>
        
        <div *ngIf="currentAvatarBase64" class="mb-4 p-4 bg-gray-50 rounded-lg">
          <div class="flex items-center justify-between">
            <div class="flex items-center space-x-3">
              <img [src]="'data:' + currentAvatarMimeType + ';base64,' + currentAvatarBase64" 
                   alt="Aperçu" 
                   class="w-16 h-16 rounded-full object-cover border-2 border-gray-300">
              <div>
                <p class="text-sm font-medium text-gray-900">{{ selectedAvatarName }}</p>
                <p class="text-xs text-gray-500">Image sélectionnée</p>
              </div>
            </div>
            <button type="button" 
                    (click)="removeAvatar()" 
                    class="text-red-600 hover:text-red-800 text-sm font-medium">
              Supprimer
            </button>
          </div>
        </div>

        <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md hover:border-gray-400 transition-colors">
          <div class="space-y-1 text-center">
            <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
              <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <div class="flex text-sm text-gray-600">
              <label for="avatar-upload" class="relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500">
                <span>{{ currentAvatarBase64 ? 'Remplacer la photo' : 'Télécharger un fichier' }}</span>
                <input id="avatar-upload" name="avatar-upload" type="file" class="sr-only" accept="image/*" (change)="onAvatarChange($event)">
              </label>
              <p class="pl-1">ou glisser-déposer</p>
            </div>
            <p class="text-xs text-gray-500">PNG, JPG, GIF jusqu'à 10MB</p>
            <div *ngIf="selectedAvatarName" class="mt-2 text-sm text-green-600">
              Nouveau fichier sélectionné: {{ selectedAvatarName }}
            </div>
            <div *ngIf="isProcessingAvatar" class="mt-2 text-sm text-blue-600">
              Traitement en cours...
            </div>
          </div>
        </div>
      </div>

      <div class="form-grid">
        <div class="form-group">
          <label for="name">Nom complet *</label>
          <input id="name" type="text" formControlName="name" class="form-input" placeholder="Sarah Martin">
          <div class="error-text" *ngIf="coachForm.get('name')?.invalid && coachForm.get('name')?.touched">
            Nom requis (min. 2 caractères)
          </div>
        </div>

        <div class="form-group">
          <label for="email">Email *</label>
          <input id="email" type="email" formControlName="email" class="form-input" placeholder="sarah@example.com">
          <div class="error-text" *ngIf="coachForm.get('email')?.invalid && coachForm.get('email')?.touched">
            Email valide requis
          </div>
        </div>

        <div class="form-group">
          <label for="experience">Expérience (années) *</label>
          <input id="experience" type="number" formControlName="experience" class="form-input" min="0">
          <div class="error-text" *ngIf="coachForm.get('experience')?.invalid && coachForm.get('experience')?.touched">
            Expérience requise
          </div>
        </div>

        <div class="form-group">
          <label for="hourlyRate">Tarif/h (€) *</label>
          <input id="hourlyRate" type="number" formControlName="hourlyRate" class="form-input" min="1">
          <div class="error-text" *ngIf="coachForm.get('hourlyRate')?.invalid && coachForm.get('hourlyRate')?.touched">
            Tarif requis (min. 1€)
          </div>
        </div>
      </div>

      <div class="form-group">
        <label>Spécialités *</label>
        <select class="form-select" (change)="onSpecialtyChange($event)">
          <option value="">Sélectionner une spécialité</option>
          <option *ngFor="let specialty of availableSpecialties" [value]="specialty">{{ specialty }}</option>
        </select>
        <div class="tags-container">
          <div class="tag" *ngFor="let specialty of specialtiesFormArray.value; let i = index">
            {{ specialty }}
            <button type="button" (click)="removeSpecialty(i)">×</button>
          </div>
        </div>
        <div class="error-text" *ngIf="specialtiesFormArray.length === 0 && coachForm.touched">
          Au moins une spécialité requise
        </div>
      </div>

      <div class="form-group">
        <label>Langues *</label>
        <select class="form-select" (change)="onLanguageChange($event)">
          <option value="">Sélectionner une langue</option>
          <option *ngFor="let language of availableLanguages" [value]="language">{{ language }}</option>
        </select>
        <div class="tags-container">
          <div class="tag" *ngFor="let language of languagesFormArray.value; let i = index">
            {{ language }}
            <button type="button" (click)="removeLanguage(i)">×</button>
          </div>
        </div>
        <div class="error-text" *ngIf="languagesFormArray.length === 0 && coachForm.touched">
          Au moins une langue requise
        </div>
      </div>

      <div class="form-grid">
        <div class="form-group">
          <label for="timezone">Fuseau horaire *</label>
          <select id="timezone" formControlName="timezone" class="form-select">
            <option *ngFor="let timezone of availableTimezones" [value]="timezone">{{ timezone }}</option>
          </select>
        </div>

        <div class="form-group">
          <label for="responseTime">Temps de réponse *</label>
          <select id="responseTime" formControlName="responseTime" class="form-select">
            <option *ngFor="let time of responseTimeOptions" [value]="time">{{ time }}</option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label for="bio">Biographie (minimum 50 caractères)</label>
        <textarea id="bio" formControlName="bio" class="form-textarea" rows="3" 
                  placeholder="Décrivez l'approche et l'expérience du coach..."></textarea>
        <div class="char-info">{{ coachForm.get('bio')?.value?.length || 0 }}/50 min</div>
        <div class="error-text" *ngIf="coachForm.get('bio')?.invalid && coachForm.get('bio')?.touched">
          Biographie requise (minimum 50 caractères)
        </div>
      </div>

      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="resetForm()">
          Réinitialiser
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="coachForm.invalid || isLoading">
          <i class="fas fa-spinner fa-spin" *ngIf="isLoading"></i>
          {{ isLoading ? 'Création...' : 'Créer le coach' }}
        </button>
      </div>
    </form>
  </div>

  <div class="coaches-list" *ngIf="!showCreateForm">
    <h3>Coachs existants</h3>
    <div class="coach-item" *ngFor="let coach of coaches">
      <div class="coach-info">
        <img [src]="coach.avatar || '/assets/default-avatar.png'" [alt]="coach.name" class="coach-avatar">
        <div class="coach-details">
          <h4>{{ coach.name }}</h4>
          <p>{{ coach.email }}</p>
          <div class="coach-meta">
            <span>{{ coach.experience }} ans • {{ coach.hourlyRate }}€/h</span>
            <div class="specialties-mini">
              <span class="specialty-mini" *ngFor="let specialty of coach.specialties.slice(0, 2)">{{ specialty }}</span>
              <span *ngIf="coach.specialties.length > 2" class="more-mini">+{{ coach.specialties.length - 2 }}</span>
            </div>
          </div>
        </div>
      </div>
      <div class="coach-actions">
        <span class="status online" *ngIf="coach.isOnline">En ligne</span>
        <span class="status offline" *ngIf="!coach.isOnline">Hors ligne</span>
        <button 
          class="delete-btn" 
          (click)="onDeleteCoach(coach)"
          title="Supprimer ce coach">
          Supprimer
        </button>
      </div>
    </div>
    
    <div class="no-coaches" *ngIf="coaches.length === 0">
      <i class="fas fa-users"></i>
      <p>Aucun coach créé pour le moment</p>
    </div>
  </div>
</div>

<style>
.delete-btn {
  background: #ef4444;
  color: white;
  border: none;
  border-radius: 4px;
  padding: 4px 8px;
  cursor: pointer;
  font-size: 12px;
  margin-left: 8px;
  transition: background-color 0.2s;
}

.delete-btn:hover {
  background: #dc2626;
}

.coach-actions {
  display: flex;
  align-items: center;
  gap: 8px;
}
</style>