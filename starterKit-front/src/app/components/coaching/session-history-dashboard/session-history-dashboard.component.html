<div class="dashboard-container">
  <!-- Header -->
  <div class="flex justify-between items-center mb-8">
    <div>
      <h1 class="text-3xl font-bold text-gray-900">Tableau de Bord Coaching</h1>
      <p class="text-gray-600 mt-2">Vue d'ensemble de vos s√©ances et progression</p>
    </div>
    
    <div class="flex items-center space-x-4">
      <select 
        [(ngModel)]="selectedPeriod" 
        (change)="onPeriodChange()"
        class="border border-gray-300 rounded-lg px-3 py-2 text-sm"
      >
        <option value="1month">Dernier mois</option>
        <option value="3months">3 derniers mois</option>
        <option value="6months">6 derniers mois</option>
        <option value="1year">Derni√®re ann√©e</option>
      </select>
      
      <button 
        (click)="refreshData()"
        class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors"
      >
        Actualiser
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="flex justify-center items-center h-64">
    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!isLoading && stats" class="space-y-8">
    
    <!-- Statistiques principales -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-header">
          <div class="stat-icon sessions">üìä</div>
        </div>
        <div class="stat-value">{{stats.totalSessions}}</div>
        <div class="stat-label">Total S√©ances</div>
        <div class="stat-change positive">+12% ce mois</div>
      </div>

      <div class="stat-card">
        <div class="stat-header">
          <div class="stat-icon rating">‚≠ê</div>
        </div>
        <div class="stat-value">{{stats.averageRating}}/5</div>
        <div class="stat-label">Note Moyenne</div>
        <div class="stat-change positive">+0.2 ce mois</div>
      </div>

      <div class="stat-card">
        <div class="stat-header">
          <div class="stat-icon progress">üìà</div>
        </div>
        <div class="stat-value">{{stats.completedSessions}}</div>
        <div class="stat-label">Sessions Termin√©es</div>
        <div class="stat-change positive">{{((stats.completedSessions / stats.totalSessions) * 100) | number:'1.0-0'}}%</div>
      </div>

      <div class="stat-card">
        <div class="stat-header">
          <div class="stat-icon time">‚è±Ô∏è</div>
        </div>
        <div class="stat-value">{{stats.totalHours}}h</div>
        <div class="stat-label">Total Heures</div>
        <div class="stat-change positive">+8h ce mois</div>
      </div>
    </div>

    <!-- Charts Section - Version simplifi√©e sans Chart.js -->
    <div class="charts-section">
      <div class="chart-card">
        <div class="chart-header">
          <h3>Progression Mensuelle</h3>
          <span class="chart-period">{{selectedPeriod}}</span>
        </div>
        <div class="chart-content">
          <!-- Graphique simple avec barres CSS -->
          <div class="space-y-4" *ngIf="stats.monthlyProgress && stats.monthlyProgress.length > 0">
            <div *ngFor="let month of stats.monthlyProgress" class="flex items-center">
              <div class="w-20 text-sm text-gray-600">{{month.month}}</div>
              <div class="flex-1 mx-4">
                <div class="bg-gray-200 rounded-full h-4">
                  <div 
                    class="bg-blue-500 h-4 rounded-full transition-all duration-500"
                    [style.width.%]="getProgressBarWidth(month.sessions, 10)"
                  ></div>
                </div>
              </div>
              <div class="w-16 text-sm text-gray-900">{{month.sessions}} sessions</div>
            </div>
          </div>
          <div *ngIf="!stats.monthlyProgress || stats.monthlyProgress.length === 0" class="text-center py-8 text-gray-500">
            Aucune donn√©e disponible
          </div>
        </div>
      </div>

      <div class="chart-card">
        <div class="chart-header">
          <h3>Progression des Comp√©tences</h3>
        </div>
        <div class="chart-content">
          <div class="space-y-3" *ngIf="stats.skillsProgress && stats.skillsProgress.length > 0">
            <div *ngFor="let skill of stats.skillsProgress" class="flex items-center">
              <div class="w-32 text-sm text-gray-700">{{skill.skill}}</div>
              <div class="flex-1 mx-4">
                <div class="bg-gray-200 rounded-full h-3">
                  <div 
                    class="h-3 rounded-full transition-all duration-500"
                    [class]="getProgressBarColor(skill.level)"
                    [style.width.%]="skill.level"
                  ></div>
                </div>
              </div>
              <div class="w-16 text-sm" [class]="getSkillLevelColor(skill.level)">
                {{skill.level}}%
              </div>
            </div>
          </div>
          <div *ngIf="!stats.skillsProgress || stats.skillsProgress.length === 0" class="text-center py-8 text-gray-500">
            Les comp√©tences appara√Ætront apr√®s vos premi√®res √©valuations
          </div>
        </div>
      </div>
    </div>

    <!-- Sujets populaires -->
    <div class="bg-white rounded-lg shadow-md p-6">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">Sujets Populaires</h3>
      <div class="space-y-3" *ngIf="stats.topTopics && stats.topTopics.length > 0">
        <div *ngFor="let topic of stats.topTopics; let i = index" class="flex items-center justify-between">
          <span class="text-sm font-medium text-gray-700">{{topic.topic}}</span>
          <div class="flex items-center">
            <div class="w-24 bg-gray-200 rounded-full h-2 mr-3">
              <div 
                class="bg-blue-600 h-2 rounded-full"
                [style.width.%]="getProgressBarWidth(topic.count, stats.totalSessions)"
              ></div>
            </div>
            <span class="text-xs text-gray-500 w-8">{{topic.count}}</span>
          </div>
        </div>
      </div>
      <div *ngIf="!stats.topTopics || stats.topTopics.length === 0" class="text-center py-4 text-gray-500">
        Aucun sujet enregistr√©
      </div>
    </div>

    <!-- Sessions r√©centes -->
    <div class="recent-sessions">
      <div class="section-header">
        <h3>Sessions R√©centes</h3>
        <a routerLink="/session-history/sessions" class="view-all-link">Voir tout</a>
      </div>
      
      <div class="space-y-4" *ngIf="recentSessions.length > 0">
        <div *ngFor="let session of recentSessions" class="session-item">
          <div class="session-info">
            <div class="session-title">{{session.topic}}</div>
            <div class="session-details">
              avec {{session.coachName}} ‚Ä¢ {{session.date | date:'short':'fr-FR'}} ‚Ä¢ {{formatDuration(session.duration)}}
            </div>
          </div>
          <div class="session-meta">
            <div class="session-rating" *ngIf="session.rating">
              <span *ngFor="let star of getRatingStars(session.rating)" 
                    class="star" 
                    [class.filled]="star.filled">‚òÖ</span>
            </div>
            <div class="session-status" [class]="getStatusColor(session.status)">
              {{getStatusLabel(session.status)}}
            </div>
          </div>
        </div>
      </div>
      
      <div *ngIf="recentSessions.length === 0" class="empty-state">
        <div class="empty-icon">üìä</div>
        <div class="empty-title">Aucune session r√©cente</div>
        <div class="empty-description">Vos sessions de coaching appara√Ætront ici</div>
      </div>
    </div>

    <!-- Actions rapides -->
    <div class="bg-white rounded-lg shadow-md p-6">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">Actions Rapides</h3>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <button 
          (click)="exportData('csv')"
          class="flex items-center justify-center px-4 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"
        >
          <svg class="w-5 h-5 mr-2 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
          </svg>
          Exporter CSV
        </button>
        
        <button 
          (click)="generateReport()"
          class="flex items-center justify-center px-4 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"
        >
          <svg class="w-5 h-5 mr-2 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
          </svg>
          G√©n√©rer Rapport
        </button>
        
        <a 
          routerLink="/session-history/sessions"
          class="flex items-center justify-center px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
        >
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
          </svg>
          Voir Sessions
        </a>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && !stats" class="empty-state">
    <div class="empty-icon">üìä</div>
    <div class="empty-title">Aucune donn√©e disponible</div>
    <div class="empty-description">Commencez par r√©server votre premi√®re session de coaching.</div>
    <button class="empty-action">
      R√©server une session
    </button>
  </div>
</div>