<div class="p-6 h-[calc(100vh-64px)] overflow-hidden flex flex-col">
  <!-- Header -->
  <div class="flex justify-between items-center mb-6">
    <div>
      <h1 class="text-2xl font-semibold text-gray-800">Coaching Platform</h1>
      <p class="text-gray-600 text-sm">Trouvez le coach parfait pour votre projet</p>
    </div>
  </div>

  <!-- Navigation Tabs -->
  <div class="flex gap-2 mb-6">
    <button
      (click)="setViewMode('browse')"
      [class]="'flex items-center gap-2 px-4 py-2 rounded-md font-medium transition-colors duration-200 ' + 
               (viewMode === 'browse' ? 'bg-secondary text-white' : 'bg-white hover:bg-gray-50 text-gray-700 border border-gray-200')"
    >
      <span class="material-icons text-lg">search</span>
      Parcourir
    </button>
    <button
      (click)="setViewMode('matched')"
      [class]="'flex items-center gap-2 px-4 py-2 rounded-md font-medium transition-colors duration-200 ' + 
               (viewMode === 'matched' ? 'bg-secondary text-white' : 'bg-white hover:bg-gray-50 text-gray-700 border border-gray-200')"
    >
      <span class="material-icons text-lg">psychology</span>
      Recommandations
    </button>
    <button
      (click)="setViewMode('calendar')"
      [class]="'flex items-center gap-2 px-4 py-2 rounded-md font-medium transition-colors duration-200 ' + 
               (viewMode === 'calendar' ? 'bg-secondary text-white' : 'bg-white hover:bg-gray-50 text-gray-700 border border-gray-200')"
    >
      <span class="material-icons text-lg">calendar_month</span>
      Calendrier
    </button>
    <button
      (click)="setViewMode('history')"
      [class]="'flex items-center gap-2 px-4 py-2 rounded-md font-medium transition-colors duration-200 ' + 
               (viewMode === 'history' ? 'bg-secondary text-white' : 'bg-white hover:bg-gray-50 text-gray-700 border border-gray-200')"
    >
      <span class="material-icons text-lg">history</span>
      Historique
    </button>
  </div>

  <!-- Main Content Area -->
  <div class="flex-1 overflow-hidden">

    <!-- Matching Panel -->
    <div *ngIf="viewMode === 'matched'" class="card p-6 mb-6">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">Critères de matching</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        <div>
          <label class="form-label">Spécialités recherchées</label>
          <select multiple [(ngModel)]="matchingCriteria.specialties" class="form-input">
            <option *ngFor="let specialty of specialties" [value]="specialty">{{specialty}}</option>
          </select>
        </div>
        <div>
          <label class="form-label">Expérience minimum (années)</label>
          <input type="number" [(ngModel)]="matchingCriteria.experience" class="form-input" />
        </div>
        <div>
          <label class="form-label">Budget maximum (€/h)</label>
          <input type="number" [(ngModel)]="matchingCriteria.maxHourlyRate" class="form-input" />
        </div>
      </div>
      <button (click)="findMatchingCoaches()" class="flex items-center gap-2 bg-secondary text-white px-6 py-2 rounded-md font-medium hover:bg-primary transition-colors duration-200 mt-4">
        <span class="material-icons text-lg mr-2">search</span>
        Trouver des coaches correspondants
      </button>
    </div>

    <!-- Search and Filters for Browse mode -->
    <div *ngIf="viewMode === 'browse'" class="card p-6 mb-6">
      <div class="flex flex-col md:flex-row gap-4">
        <div class="flex-1">
          <input
            type="text"
            [(ngModel)]="searchTerm"
            (ngModelChange)="onSearchChange()"
            placeholder="Rechercher un coach..."
            class="form-input"
          />
        </div>
        <div>
          <select [(ngModel)]="filterSpecialty" (ngModelChange)="onSpecialtyFilterChange()" class="form-input">
            <option value="">Toutes les spécialités</option>
            <option *ngFor="let specialty of specialties" [value]="specialty">{{specialty}}</option>
          </select>
        </div>
        <button (click)="toggleFilters()" class="btn-secondary">
          <span class="material-icons text-lg mr-2">tune</span>
          Filtres avancés
        </button>
      </div>

      <!-- Advanced Filters Panel -->
      <div *ngIf="showFilters" class="mt-6 p-4 bg-gray-50 rounded-xl border">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <label class="form-label">Prix maximum</label>
            <input
              type="range"
              [(ngModel)]="matchingCriteria.maxHourlyRate"
              min="50"
              max="500"
              class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
            />
            <span class="text-sm text-gray-600">{{matchingCriteria.maxHourlyRate}}€/h</span>
          </div>
          <div>
            <label class="form-label">Expérience minimum</label>
            <input
              type="range"
              [(ngModel)]="matchingCriteria.experience"
              min="0"
              max="20"
              class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
            />
            <span class="text-sm text-gray-600">{{matchingCriteria.experience}} ans</span>
          </div>
          <div>
            <label class="form-label">Disponibilité</label>
            <select [(ngModel)]="matchingCriteria.availability" class="form-input">
              <option value="any">Peu importe</option>
              <option value="immediate">Immédiate</option>
              <option value="week">Cette semaine</option>
              <option value="month">Ce mois</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- Content Area with Overflow -->
    <div class="flex-1 overflow-y-auto">

      <!-- Browse View -->
      <div *ngIf="viewMode === 'browse'" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <div *ngFor="let coach of filteredCoaches" class="card p-6 cursor-pointer" (click)="selectCoach(coach)">
          <div class="flex items-start space-x-4">
            <div class="relative">
              <img
                [src]="coach.avatar || '/api/placeholder/64/64'"
                [alt]="coach.name"
                class="w-16 h-16 rounded-full object-cover"
              />
              <div *ngIf="coach.isOnline" 
                   class="absolute -bottom-1 -right-1 w-5 h-5 bg-green-500 rounded-full border-2 border-white">
              </div>
            </div>
            <div class="flex-1 min-w-0">
              <h3 class="text-lg font-semibold text-gray-900 truncate">{{coach.name}}</h3>
              <div class="flex items-center mt-1">
                <div class="flex">
                  <span 
                    *ngFor="let star of renderStars(coach.rating)" 
                    [class]="'material-icons text-sm ' + (star ? 'text-warning' : 'text-gray-300')"
                  >
                    star
                  </span>
                </div>
                <span class="ml-2 text-sm text-gray-600">
                  {{coach.rating}} ({{coach.reviewsCount}})
                </span>
              </div>
              <p class="text-gray-600 mt-2 text-sm line-clamp-2">{{coach.bio}}</p>
              <div class="flex flex-wrap gap-1 mt-3">
                <span 
                  *ngFor="let specialty of coach.specialties.slice(0, 2)" 
                  class="bg-secondary/10 text-secondary px-2 py-1 rounded-full text-xs font-medium"
                >
                  {{specialty}}
                </span>
              </div>
              <div class="flex items-center justify-between mt-4">
                <div class="flex items-center space-x-3 text-xs text-gray-500">
                  <span class="flex items-center">
                    <span class="material-icons text-sm mr-1">schedule</span>
                    {{coach.responseTime}}
                  </span>
                  <span class="flex items-center">
                    <span class="material-icons text-sm mr-1">workspace_premium</span>
                    {{coach.experience}} ans
                  </span>
                </div>
                <div class="text-right">
                  <div class="text-lg font-semibold text-success">{{coach.hourlyRate}}€/h</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Matched View -->
      <div *ngIf="viewMode === 'matched'" class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div *ngFor="let coach of getMatchedCoaches()" class="card p-6 cursor-pointer" (click)="selectCoach(coach)">
          <div class="flex items-start space-x-4">
            <div class="relative">
              <img
                [src]="coach.avatar || '/api/placeholder/64/64'"
                [alt]="coach.name"
                class="w-16 h-16 rounded-full object-cover"
              />
              <div *ngIf="coach.isOnline" 
                   class="absolute -bottom-1 -right-1 w-5 h-5 bg-green-500 rounded-full border-2 border-white">
              </div>
            </div>
            <div class="flex-1">
              <div class="flex items-center justify-between">
                <h3 class="text-lg font-semibold text-gray-900">{{coach.name}}</h3>
                <div class="bg-secondary text-white px-3 py-1 rounded-full text-sm font-medium">
                  {{coach.matchScore?.toFixed(0) || 0}}% match
                </div>
              </div>
              <div class="flex items-center mt-1">
                <div class="flex">
                  <span 
                    *ngFor="let star of renderStars(coach.rating)" 
                    [class]="'material-icons text-sm ' + (star ? 'text-warning' : 'text-gray-300')"
                  >
                    star
                  </span>
                </div>
                <span class="ml-2 text-sm text-gray-600">
                  {{coach.rating}} ({{coach.reviewsCount}})
                </span>
              </div>
              <p class="text-gray-600 mt-2 text-sm">{{coach.bio}}</p>
              <div class="flex flex-wrap gap-1 mt-3">
                <span 
                  *ngFor="let specialty of coach.specialties.slice(0, 3)" 
                  class="bg-secondary/10 text-secondary px-2 py-1 rounded-full text-xs font-medium"
                >
                  {{specialty}}
                </span>
              </div>
              <div class="flex items-center justify-between mt-4">
                <div class="flex items-center space-x-3 text-xs text-gray-500">
                  <span>{{coach.experience}} ans</span>
                  <span>{{coach.responseTime}}</span>
                </div>
                <div class="text-lg font-semibold text-success">{{coach.hourlyRate}}€/h</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Calendar View -->
      <div *ngIf="viewMode === 'calendar'" class="card p-6">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">
          <span class="material-icons text-lg mr-2 align-middle">calendar_month</span>
          Disponibilités {{ selectedCoach ? 'de ' + selectedCoach.name : '' }}
        </h3>
        <div *ngIf="selectedCoach && getCoachAvailability(selectedCoach.id); else noSelection">
          <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
            <button
              *ngFor="let slot of getCoachAvailability(selectedCoach.id)!.timeSlots"
              [disabled]="slot.isBooked"
              (click)="openBookingModal(getCoachAvailability(selectedCoach.id)!.date, slot)"
              [class]="'p-3 rounded-xl text-sm font-medium transition-all duration-200 border ' + 
                       (slot.isBooked ? 
                         'bg-gray-100 text-gray-400 cursor-not-allowed border-gray-200' : 
                         'bg-white hover:bg-secondary hover:text-white border-gray-200 hover:border-secondary cursor-pointer')"
            >
              {{slot.start}} - {{slot.end}}
              <div class="text-xs mt-1 opacity-80">{{slot.price}}€</div>
            </button>
          </div>
        </div>
        <ng-template #noSelection>
          <div class="text-center py-12">
            <span class="material-icons text-4xl text-gray-300 mb-4">person_search</span>
            <p class="text-gray-600">Sélectionnez un coach pour voir ses disponibilités</p>
          </div>
        </ng-template>
      </div>

      <!-- History View -->
      <div *ngIf="viewMode === 'history'" class="card p-6">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">
          <span class="material-icons text-lg mr-2 align-middle">history</span>
          Historique des séances
        </h3>
        <div class="space-y-4">
          <div *ngFor="let session of sessions" class="border border-gray-200 rounded-xl p-4 hover:border-gray-300 transition-all duration-200">
            <div class="flex items-center justify-between">
              <div>
                <h4 class="font-semibold text-gray-900">{{session.topic}}</h4>
                <p class="text-sm text-gray-600 mt-1">
                  avec {{getCoachFromSession(session)?.name}} • {{session.date | date:'short'}}
                </p>
              </div>
              <div class="text-right">
                <span [class]="'px-3 py-1 rounded-full text-xs font-medium ' + 
                             (session.status === 'completed' ? 'bg-green-100 text-green-800' :
                              session.status === 'scheduled' ? 'bg-secondary/10 text-secondary' :
                              'bg-red-100 text-red-800')">
                  {{session.status}}
                </span>
                <div *ngIf="session.rating" class="flex items-center mt-2 justify-end">
                  <span 
                    *ngFor="let star of renderStars(session.rating)" 
                    [class]="'material-icons text-xs ' + (star ? 'text-warning' : 'text-gray-300')"
                  >
                    star
                  </span>
                </div>
              </div>
            </div>
            <p *ngIf="session.notes" class="text-sm text-gray-600 mt-3 bg-gray-50 p-3 rounded-lg">
              {{session.notes}}
            </p>
          </div>
          
          <div *ngIf="sessions.length === 0" class="text-center py-12">
            <span class="material-icons text-4xl text-gray-300 mb-4">event_busy</span>
            <p class="text-gray-600">Aucune séance dans l'historique</p>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- Coach Profile Modal -->
<div *ngIf="selectedCoach" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
  <div class="bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
    <div class="p-6">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-semibold text-gray-800">Profil de {{selectedCoach.name}}</h2>
        <button (click)="closeCoachProfile()" class="p-2 rounded-full hover:bg-gray-100 text-gray-500 hover:text-gray-700 transition-colors">
          <span class="material-icons">close</span>
        </button>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div class="lg:col-span-2">
          <div class="flex items-start space-x-4 mb-6">
            <img
              [src]="selectedCoach.avatar || '/api/placeholder/80/80'"
              [alt]="selectedCoach.name"
              class="w-20 h-20 rounded-full object-cover"
            />
            <div>
              <h3 class="text-xl font-semibold text-gray-900">{{selectedCoach.name}}</h3>
              <div class="flex items-center mt-1">
                <div class="flex">
                  <span 
                    *ngFor="let star of renderStars(selectedCoach.rating)" 
                    [class]="'material-icons text-sm ' + (star ? 'text-warning' : 'text-gray-300')"
                  >
                    star
                  </span>
                </div>
                <span class="ml-2 text-sm text-gray-600">
                  {{selectedCoach.rating}}/5 ({{selectedCoach.reviewsCount}} avis)
                </span>
              </div>
              <p class="text-gray-600 mt-2">{{selectedCoach.bio}}</p>
              <div class="flex items-center gap-4 mt-4 text-sm text-gray-600">
                <span>{{selectedCoach.experience}} ans d'expérience</span>
                <span>{{selectedCoach.responseTime}} de réponse</span>
                <span class="text-success font-semibold">{{selectedCoach.hourlyRate}}€/h</span>
              </div>
            </div>
          </div>

          <div class="space-y-6">
            <div>
              <h4 class="font-semibold text-gray-800 mb-3">Spécialités</h4>
              <div class="flex flex-wrap gap-2">
                <span 
                  *ngFor="let specialty of selectedCoach.specialties" 
                  class="bg-secondary text-white px-3 py-1 rounded-full text-sm font-medium"
                >
                  {{specialty}}
                </span>
              </div>
            </div>

            <div>
              <h4 class="font-semibold text-gray-800 mb-3">Certifications</h4>
              <ul class="space-y-1">
                <li *ngFor="let cert of selectedCoach.certifications" class="text-sm text-gray-600 flex items-center">
                  <span class="material-icons text-sm mr-2 text-success">verified</span>
                  {{cert}}
                </li>
              </ul>
            </div>

            <div>
              <h4 class="font-semibold text-gray-800 mb-3">Langues</h4>
              <div class="flex flex-wrap gap-2">
                <span 
                  *ngFor="let language of selectedCoach.languages" 
                  class="bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm"
                >
                  {{language}}
                </span>
              </div>
            </div>

            <div>
              <h4 class="font-semibold text-gray-800 mb-3">Avis récents</h4>
              <div class="space-y-4">
                <div *ngFor="let review of getCoachReviews(selectedCoach.id)" class="border-l-4 border-secondary pl-4">
                  <div class="flex items-center justify-between mb-1">
                    <span class="font-medium text-sm text-gray-900">{{review.userName}}</span>
                    <div class="flex">
                      <span 
                        *ngFor="let star of renderStars(review.rating)" 
                        [class]="'material-icons text-xs ' + (star ? 'text-warning' : 'text-gray-300')"
                      >
                        star
                      </span>
                    </div>
                  </div>
                  <p class="text-sm text-gray-600 mb-1">{{review.comment}}</p>
                  <p class="text-xs text-gray-400">{{review.date | date:'short'}} • {{review.sessionTopic}}</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div>
          <div class="card p-4">
            <h4 class="font-semibold text-gray-800 mb-3">Actions</h4>
            <div class="space-y-3">
              <button (click)="goToCalendar()" class="btn-primary w-full">
                <span class="material-icons text-lg mr-2">calendar_month</span>
                Voir disponibilités
              </button>
              <button (click)="closeCoachProfile()" class="btn-secondary w-full">
                Fermer
              </button>
            </div>
          </div>

          <div class="card p-4 mt-4">
            <h4 class="font-semibold text-gray-800 mb-3">Statistiques</h4>
            <div class="space-y-3">
              <div class="flex justify-between text-sm">
                <span class="text-gray-600">Sessions totales:</span>
                <span class="font-semibold text-gray-900">{{selectedCoach.totalSessions}}</span>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-gray-600">Taux de succès:</span>
                <span class="font-semibold text-success">{{selectedCoach.successRate}}%</span>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-gray-600">Statut:</span>
                <span [class]="selectedCoach.isOnline ? 'text-success font-semibold' : 'text-gray-500'">
                  <span class="material-icons text-xs mr-1 align-middle">
                    {{selectedCoach.isOnline ? 'radio_button_checked' : 'radio_button_unchecked'}}
                  </span>
                  {{selectedCoach.isOnline ? 'En ligne' : 'Hors ligne'}}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Booking Modal -->
<div *ngIf="showBookingModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
  <div class="bg-white rounded-2xl max-w-md w-full shadow-2xl">
    <div class="p-6">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold text-gray-800">Réserver une séance</h3>
        <button (click)="closeBookingModal()" class="p-2 rounded-full hover:bg-gray-100 text-gray-500 hover:text-gray-700 transition-colors">
          <span class="material-icons">close</span>
        </button>
      </div>

      <div *ngIf="selectedTimeSlot" class="space-y-4">
        <div class="card p-4">
          <h4 class="font-semibold text-gray-800 mb-3">Détails de la réservation</h4>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between">
              <span class="text-gray-600">Coach:</span>
              <span class="font-medium text-gray-900">{{selectedCoach?.name}}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">Date:</span>
              <span class="font-medium text-gray-900">{{selectedTimeSlot.date | date:'fullDate'}}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">Heure:</span>
              <span class="font-medium text-gray-900">{{selectedTimeSlot.slot.start}} - {{selectedTimeSlot.slot.end}}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">Prix:</span>
              <span class="font-semibold text-success">{{selectedTimeSlot.slot.price}}€</span>
            </div>
          </div>
        </div>

        <div>
          <label class="form-label">Sujet de la séance</label>
          <input
            #sessionTopic
            type="text"
            placeholder="Ex: Stratégie produit, Marketing digital..."
            class="form-input"
          />
        </div>

        <div class="flex space-x-3">
          <button (click)="closeBookingModal()" class="btn-secondary flex-1">
            Annuler
          </button>
          <button (click)="bookSession(sessionTopic.value || 'Session de coaching')" class="btn-primary flex-1">
            <span class="material-icons text-lg mr-2">check</span>
            Confirmer
          </button>
        </div>
      </div>
    </div>
  </div>
</div>