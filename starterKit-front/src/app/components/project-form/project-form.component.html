<div class="overlay" (click)="onCancel()"></div>
<div class="modal" (click)="$event.stopPropagation()">
  <div class="modal-header">
    <h2>{{ project ? 'Edit Project' : 'New Project' }}</h2>
    <button class="close-button" (click)="onCancel()">
      <span class="material-icons">close</span>
    </button>
  </div>
  
  <form [formGroup]="projectForm" (ngSubmit)="onSubmit()">
    <div class="form-group">
      <label for="title">Title</label>
      <input type="text" id="title" formControlName="title" placeholder="Project title">
      <div class="error-message" *ngIf="projectForm.get('title')?.invalid && projectForm.get('title')?.touched">
        Title is required and must be at least 3 characters
      </div>
    </div>
    
    <div class="form-group">
      <label for="description">Description</label>
      <textarea id="description" formControlName="description" placeholder="Project description" rows="3"></textarea>
      <div class="error-message" *ngIf="projectForm.get('description')?.invalid && projectForm.get('description')?.touched">
        Description is required
      </div>
    </div>
    
    <div class="form-group">
      <label for="stage">Stage</label>
      <select id="stage" formControlName="stage">
        <option *ngFor="let stage of projectStages" [value]="stage">{{ stage }}</option>
      </select>
    </div>
    
    <div class="form-group">
      <label for="priority">Priority</label>
      <select id="priority" formControlName="priority">
        <option *ngFor="let priority of priorities" [value]="priority">{{ priority }}</option>
      </select>
    </div>

    <div class="form-group">
      <label>Team Members</label>
      <div class="team-selection">
        <div *ngIf="availableMembers.length === 0" class="loading">
          Loading team members...
        </div>
        <div *ngFor="let member of availableMembers" class="member-checkbox">
          <input 
            type="checkbox" 
            [id]="'member-' + member.id"
            [checked]="isSelectedMember(member.id)"
            (change)="toggleMember(member.id)">
          <label [for]="'member-' + member.id" class="member-label">
            <img [src]="member.avatar" [alt]="member.name" class="member-avatar">
            <div class="member-info">
              <span class="member-name">{{ member.name }}</span>
              <span class="member-role">{{ member.role }}</span>
            </div>
          </label>
        </div>
      </div>
      <div class="selected-members" *ngIf="selectedTeamIds.length > 0">
        <h4>Selected Members ({{ selectedTeamIds.length }})</h4>
        <div class="selected-list">
          <div *ngFor="let memberId of selectedTeamIds" class="selected-member">
            <img [src]="getMemberById(memberId)?.avatar" [alt]="getMemberById(memberId)?.name" class="selected-avatar">
            <span>{{ getMemberById(memberId)?.name }}</span>
            <button type="button" (click)="removeMember(memberId)" class="remove-btn">
              <span class="material-icons">close</span>
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <div class="form-group">
      <label for="progress">Progress ({{ projectForm.get('progress')?.value }}%)</label>
      <input type="range" id="progress" formControlName="progress" min="0" max="100" step="5">
    </div>
    
    <div class="form-group">
      <label for="deadline">Deadline</label>
      <input type="date" id="deadline" formControlName="deadline">
      <div class="error-message" *ngIf="projectForm.get('deadline')?.invalid && projectForm.get('deadline')?.touched">
        Deadline is required
      </div>
    </div>

    <div class="form-group">
      <label for="reminderDate">Reminder Date (Optional)</label>
      <input type="date" id="reminderDate" formControlName="reminderDate">
    </div>

    <div class="form-group">
      <label for="tags">Tags (comma-separated)</label>
      <input type="text" id="tags" formControlName="tags" placeholder="tag1, tag2, tag3">
    </div>

    <div class="form-group">
      <label>Project Instructions</label>
      <app-user-instructions
        [projectId]="project?.id || ''"
        [initialInstructions]="project?.instructions || []"
        (instructionsChange)="onInstructionsChange($event)"
      ></app-user-instructions>
    </div>
    
    <div class="form-actions">
      <button type="button" class="btn-secondary" (click)="onCancel()">Cancel</button>
      <button type="submit" class="btn-primary" [disabled]="projectForm.invalid">Save</button>
    </div>
  </form>
</div>