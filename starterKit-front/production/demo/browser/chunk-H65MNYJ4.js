import{Cb as U,Db as F,La as j,P as f,Qb as L,R as i,Ra as N,S as T,U as E,Ub as O,W as _,X as s,Xb as p,_ as y,f as I,ha as D,j as w,ka as R,oa as b,r as l,ra as S,ta as A,ub as h}from"./chunk-CDT77BCM.js";var c=class extends Error{};c.prototype.name="InvalidTokenError";function x(e){return decodeURIComponent(atob(e).replace(/(.)/g,(r,t)=>{let o=t.charCodeAt(0).toString(16).toUpperCase();return o.length<2&&(o="0"+o),"%"+o}))}function B(e){let r=e.replace(/-/g,"+").replace(/_/g,"/");switch(r.length%4){case 0:break;case 2:r+="==";break;case 3:r+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return x(r)}catch{return atob(r)}}function M(e,r){if(typeof e!="string")throw new c("Invalid token specified: must be a string");r||(r={});let t=r.header===!0?0:1,o=e.split(".")[t];if(typeof o!="string")throw new c(`Invalid token specified: missing part #${t+1}`);let n;try{n=B(o)}catch(a){throw new c(`Invalid token specified: invalid base64 for part #${t+1} (${a.message})`)}try{return JSON.parse(n)}catch(a){throw new c(`Invalid token specified: invalid json for part #${t+1} (${a.message})`)}}var J=(()=>{class e{constructor(t){this.http=t,this.EXTERNAL_AUTH_URL=p.externaleAuthUrl,this.VERIFY_TOKEN_URL=p.verifyTokenUrl,this.tokenSubject=new w(null),this.token$=this.tokenSubject.asObservable(),console.log("JwtService initialized with URLs:",{verifyTokenUrl:this.VERIFY_TOKEN_URL,externalAuthUrl:this.EXTERNAL_AUTH_URL}),this.initializeToken()}initializeToken(){let t=this.getTokenFromUrl();if(t){this.setToken(t);return}let o=this.decodeToken();o?this.tokenSubject.next(o):this.tokenSubject.next(null)}verifyTokenWithApi(){let t=this.getToken();return t?this.http.post(this.VERIFY_TOKEN_URL,{token:t},{headers:{Authorization:`Bearer ${t}`}}).pipe(f(o=>console.log("API verification response:",o)),l(o=>o.success===!0)):new I(o=>{o.next(!1),o.complete()})}getToken(){return sessionStorage.getItem("startupkit_SESSION")}setToken(t){console.log("Setting token in sessionStorage"),sessionStorage.setItem("startupkit_SESSION",t);let o=this.decodeToken();this.tokenSubject.next(o)}removeToken(){console.log("Removing token from sessionStorage"),sessionStorage.removeItem("startupkit_SESSION"),this.tokenSubject.next(null)}checkTokenAndRedirect(){let t=this.getTokenFromUrl();return t&&this.setToken(t),this.verifyTokenWithApi().pipe(f(o=>console.log("Token verification result in checkTokenAndRedirect:",o)),l(o=>o?!0:(console.log("Token invalid, removing token and redirecting to login"),this.removeToken(),this.redirectLoginPage(),!1)))}redirectLoginPage(){console.log("Redirecting to login page:",this.EXTERNAL_AUTH_URL),window.location.href=this.EXTERNAL_AUTH_URL}getTokenFromUrl(){let o=new URLSearchParams(window.location.search).get("token");return console.log("getTokenFromUrl called, token found:",!!o),o}decodeToken(){let t=this.getToken();if(!t)return null;try{return M(t)}catch(o){return console.error("Error decoding token:",o),null}}updateTokenObservable(){let t=this.decodeToken();this.tokenSubject.next(t)}static{this.\u0275fac=function(o){return new(o||e)(_(O))}}static{this.\u0275prov=i({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var m;function P(){if(m==null){let e=typeof document<"u"?document.head:null;m=!!(e&&(e.createShadowRoot||e.attachShadow))}return m}function Q(e){if(P()){let r=e.getRootNode?e.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&r instanceof ShadowRoot)return r}return null}function Z(e){return e.composedPath?e.composedPath()[0]:e.target}function te(e){return e.buttons===0||e.detail===0}function oe(e){let r=e.touches&&e.touches[0]||e.changedTouches&&e.changedTouches[0];return!!r&&r.identifier===-1&&(r.radiusX==null||r.radiusX===1)&&(r.radiusY==null||r.radiusY===1)}function ie(e,r=0){return C(e)?Number(e):arguments.length===2?r:0}function C(e){return!isNaN(parseFloat(e))&&!isNaN(Number(e))}function se(e){return e instanceof b?e.nativeElement:e}function de(e,r,t,o,n){let a=parseInt(h.major),k=parseInt(h.minor);return a>19||a===19&&k>0||a===0&&k===0?e.listen(r,t,o,n):(r.addEventListener(t,o,n),()=>{r.removeEventListener(t,o,n)})}var u=new WeakMap,he=(()=>{class e{_appRef;_injector=s(D);_environmentInjector=s(y);load(t){let o=this._appRef=this._appRef||this._injector.get(N),n=u.get(o);n||(n={loaders:new Set,refs:[]},u.set(o,n),o.onDestroy(()=>{u.get(o)?.refs.forEach(a=>a.destroy()),u.delete(o)})),n.loaders.has(t)||(n.loaders.add(t),n.refs.push(U(t,{environmentInjector:this._environmentInjector})))}static \u0275fac=function(o){return new(o||e)};static \u0275prov=i({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var g;try{g=typeof Intl<"u"&&Intl.v8BreakIterator}catch{g=!1}var ke=(()=>{class e{_platformId=s(A);isBrowser=this._platformId?L(this._platformId):typeof document=="object"&&!!document;EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent);TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent);BLINK=this.isBrowser&&!!(window.chrome||g)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT;WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT;IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window);FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent);ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT;SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT;constructor(){}static \u0275fac=function(o){return new(o||e)};static \u0275prov=i({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var $=new E("cdk-dir-doc",{providedIn:"root",factory:V});function V(){return s(F)}var K=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;function W(e){let r=e?.toLowerCase()||"";return r==="auto"&&typeof navigator<"u"&&navigator?.language?K.test(navigator.language)?"rtl":"ltr":r==="rtl"?"rtl":"ltr"}var _e=(()=>{class e{value="ltr";change=new R;constructor(){let t=s($,{optional:!0});if(t){let o=t.body?t.body.dir:null,n=t.documentElement?t.documentElement.dir:null;this.value=W(o||n||"ltr")}}ngOnDestroy(){this.change.complete()}static \u0275fac=function(o){return new(o||e)};static \u0275prov=i({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var Se=(()=>{class e{static \u0275fac=function(o){return new(o||e)};static \u0275mod=j({type:e});static \u0275inj=T({})}return e})();var v={},Ue=(()=>{class e{_appId=s(S);getId(t){return this._appId!=="ng"&&(t+=this._appId),v.hasOwnProperty(t)||(v[t]=0),`${t}${v[t]++}`}static \u0275fac=function(o){return new(o||e)};static \u0275prov=i({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function Le(e){return Array.isArray(e)?e:[e]}export{J as a,Q as b,Z as c,te as d,oe as e,ie as f,se as g,de as h,he as i,ke as j,_e as k,Se as l,Ue as m,Le as n};
